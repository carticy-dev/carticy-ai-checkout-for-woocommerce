!function($){"use strict";var e={init:function(){this.bindEvents()},bindEvents:function(){$(".copy-button").on("click",this.copyToClipboard.bind(this)),$(".regenerate-api-key").on("click",this.regenerateApiKey.bind(this)),$(".regenerate-webhook-secret").on("click",this.regenerateWebhookSecret.bind(this)),$(".test-webhook").on("click",this.testWebhook.bind(this))},copyToClipboard:function(e){e.preventDefault();var t=$(e.currentTarget),c=t.data("clipboard-target"),a=$(c);if(a.length){a.select();try{document.execCommand("copy"),this.showCopyFeedback(t,!0)}catch(e){this.showCopyFeedback(t,!1)}window.getSelection().removeAllRanges()}},showCopyFeedback:function(e,t){var c=e.text(),a=t?carticySettings.i18n.copied:carticySettings.i18n.copyFailed;e.text(a),t&&e.addClass("copied"),setTimeout(function(){e.text(c),e.removeClass("copied")},2e3)},regenerateApiKey:function(t){if(t.preventDefault(),confirm(carticySettings.i18n.confirmRegenerate)){var c=$(t.currentTarget),a=c.text();c.addClass("loading").prop("disabled",!0),c.text(carticySettings.i18n.regenerating),$.ajax({url:carticySettings.ajaxUrl,type:"POST",data:{action:"carticy_ai_checkout_regenerate_api_key",nonce:carticySettings.nonce},success:function(t){t.success?($("#api-key").val(t.data.api_key),e.showNotice(t.data.message,"success")):e.showNotice(t.data.message||"Failed to regenerate API key","error")},error:function(){e.showNotice("An error occurred. Please try again.","error")},complete:function(){c.removeClass("loading").prop("disabled",!1),c.text(a)}})}},regenerateWebhookSecret:function(t){if(t.preventDefault(),confirm(carticySettings.i18n.confirmRegenerate)){var c=$(t.currentTarget),a=c.text();c.addClass("loading").prop("disabled",!0),c.text(carticySettings.i18n.regenerating),$.ajax({url:carticySettings.ajaxUrl,type:"POST",data:{action:"carticy_ai_checkout_regenerate_webhook_secret",nonce:carticySettings.nonce},success:function(t){t.success?($("#webhook-secret").val(t.data.webhook_secret),e.showNotice(t.data.message,"success")):e.showNotice(t.data.message||"Failed to regenerate webhook secret","error")},error:function(){e.showNotice("An error occurred. Please try again.","error")},complete:function(){c.removeClass("loading").prop("disabled",!1),c.text(a)}})}},testWebhook:function(e){e.preventDefault();var t=$(e.currentTarget),c=$("#webhook-test-result"),a=t.text();t.addClass("loading").prop("disabled",!0),t.text(carticySettings.i18n.testingWebhook),c.removeClass("success error").text(""),$.ajax({url:carticySettings.ajaxUrl,type:"POST",data:{action:"carticy_ai_checkout_test_webhook",nonce:carticySettings.nonce},success:function(e){e.success?c.addClass("success").text(e.data.message||carticySettings.i18n.webhookSuccess):c.addClass("error").text(e.data.message||carticySettings.i18n.webhookFailed)},error:function(e){var t=carticySettings.i18n.webhookFailed;e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.message&&(t=e.responseJSON.data.message),c.addClass("error").text(t)},complete:function(){t.removeClass("loading").prop("disabled",!1),t.text(a)}})},showNotice:function(e,t){var c=$('<div class="notice '+("success"===t?"notice-success":"notice-error")+' is-dismissible"><p>'+e+"</p></div>");$(".carticy-ai-checkout h1").after(c),setTimeout(function(){c.fadeOut(function(){$(this).remove()})},5e3),c.on("click",".notice-dismiss",function(){c.fadeOut(function(){$(this).remove()})})}};$(document).ready(function(){e.init()})}(jQuery);