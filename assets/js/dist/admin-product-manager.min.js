!function($){"use strict";var e={init:function(){this.bindEvents()},bindEvents:function(){$(".carticy-preview-feed").off("click").on("click",this.handlePreviewFeed),$("#carticy-regenerate-feed").off("click").on("click",this.handleRegenerateFeed),$("#carticy-recalculate-quality").off("click").on("click",this.handleRecalculateQuality),$(".quality-issues-toggle").off("click").on("click",this.handleQualityIssuesToggle)},handlePreviewFeed:function(a){a.preventDefault();var t=$(this).data("product-id");CarticyAdmin.Modal.open({title:"Product Feed Preview",content:'<div style="text-align: center; padding: 40px; color: #666;">Loading...</div>',size:"large"}),$.ajax({url:carticyProductManager.ajax_url,type:"POST",data:{action:"carticy_ai_checkout_preview_product_feed",nonce:carticyProductManager.nonce,product_id:t},success:function(a){if(a.success&&a.data.feed){var t=$("<pre>").css({background:"#f6f7f7",border:"1px solid #c3c4c7",borderRadius:"4px",padding:"16px",margin:"0",fontFamily:'"Courier New", Courier, monospace',fontSize:"12px",lineHeight:"1.6",overflowX:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",maxHeight:"500px"}).text(a.data.feed);CarticyAdmin.Modal.open({title:"Product Feed Preview",content:t,size:"large",actions:[{label:carticyProductManager.i18n.copy||"Copy to Clipboard",class:"button-primary",onClick:function(){var t=$(this),c=t.text();e.copyToClipboard(a.data.feed),t.text(carticyProductManager.i18n.copied||"Copied!").css("opacity","0.7"),setTimeout(function(){t.text(c).css("opacity","1")},2e3)}}]})}else CarticyAdmin.Modal.close(),e.showError(a.data.message||"Failed to load feed preview.")},error:function(){CarticyAdmin.Modal.close(),e.showError("An error occurred while loading the feed preview.")}})},copyToClipboard:function(a){var t=$("<textarea>");$("body").append(t),t.val(a).select();try{document.execCommand("copy"),e.showSuccess(carticyProductManager.i18n.copied)}catch(a){e.showError("Failed to copy to clipboard.")}t.remove()},handleRegenerateFeed:function(a){if(a.preventDefault(),confirm(carticyProductManager.i18n.confirm_regenerate)){var t=$(this);t.addClass("loading").prop("disabled",!0),$.ajax({url:carticyProductManager.ajax_url,type:"POST",data:{action:"carticy_ai_checkout_regenerate_feed",nonce:carticyProductManager.nonce},success:function(a){a.success?(e.showSuccess(a.data.message),setTimeout(function(){location.reload()},1500)):(e.showError(a.data.message||"Failed to regenerate feed."),t.removeClass("loading").prop("disabled",!1))},error:function(){e.showError("An error occurred while regenerating the feed."),t.removeClass("loading").prop("disabled",!1)}})}},handleRecalculateQuality:function(a){if(a.preventDefault(),confirm(carticyProductManager.i18n.confirm_recalculate)){var t=$(this);t.addClass("loading").prop("disabled",!0),$.ajax({url:carticyProductManager.ajax_url,type:"POST",data:{action:"carticy_ai_checkout_recalculate_quality",nonce:carticyProductManager.nonce},success:function(a){a.success?(e.showSuccess(a.data.message),setTimeout(function(){location.reload()},1500)):(e.showError(a.data.message||"Failed to recalculate quality scores."),t.removeClass("loading").prop("disabled",!1))},error:function(){e.showError("An error occurred while recalculating quality scores."),t.removeClass("loading").prop("disabled",!1)}})}},handleQualityIssuesToggle:function(a){a.preventDefault();var t=$(this).data("issues"),c=e.createTooltip(t),r=$(this).offset();c.css({top:r.top-c.outerHeight()-10,left:r.left+$(this).outerWidth()/2-c.outerWidth()/2}),setTimeout(function(){c.fadeOut(function(){$(this).remove()})},5e3)},createTooltip:function(e){var a=$('<div class="carticy-ai-quality-tooltip"></div>').html(e);return $("body").append(a),a},showSuccess:function(e){var a=$('<div class="notice notice-success is-dismissible"><p>'+e+"</p></div>");$(".wrap.carticy-ai-checkout-products").prepend(a),setTimeout(function(){a.fadeOut(function(){$(this).remove()})},3e3)},showError:function(e){var a=$('<div class="notice notice-error is-dismissible"><p>'+e+"</p></div>");$(".wrap.carticy-ai-checkout-products").prepend(a)}};$(document).ready(function(){e.init()})}(jQuery);